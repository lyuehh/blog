<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Io学习笔记之二</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">
         <link type="text/css" rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.0.0/css/bootstrap-theme.min.css"/>
         <link type="text/css" rel="stylesheet" href="http://cdn.staticfile.org/twitter-bootstrap/3.0.0/css/bootstrap.min.css"/>
    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/index.html">blog</a></h1>
              <a class="extra" href="/about.html">about</a>
            </div>

            <h2>Io学习笔记之二</h2>
<p class="meta">2012-12-28 21:15</p>

<div id="post">
<h2>条件和循环</h2>

<h3>无限循环</h3>

<pre><code>
Io&gt; loop("haha..." println)
haha...
haha...
...
</code></pre>

<p>按Ctrl+C中断</p>

<h3>while循环</h3>

<pre><code>
Io&gt; while(i &lt;= 11, i println; i = i + 1); "The end..." println
1
2
3
4
5
6
7
8
9
10
11
The end...
==&gt; The end...
</code></pre>

<h3>for循环</h3>

<pre><code>
Io&gt; for(i, 1, 11, i println); "The end..." println
1
2
3
4
5
6
7
8
9
10
11
The end...
==&gt; The end...
</code></pre>

<p>其中第4个参数为可选的增量，像这样</p>

<pre><code>
Io&gt; for(i, 1, 11, 2, i println)
1
3
5
7
9
11
==&gt; 11
</code></pre>

<p>Io允许附加额外参数，所以一定要小心，像这样的代码</p>

<pre><code>
Io&gt; for(i, 1, 2, i println)
1
2
==&gt; 2
Io&gt; for(i, 1, 2, i println, "extra arg")
2
==&gt; extra arg
</code></pre>

<h3>if控制结构</h3>

<pre><code>
Io&gt; if(true, "It is true.", "It is false.")
==&gt; It is true.
Io&gt; if(false) then("It is true") else("It is false")
==&gt; nil
Io&gt; if(false) then("It is true." println) else("It is false." println)
It is false.
==&gt; nil
</code></pre>

<h3>运算符</h3>

<p>Io里你可以直接看到运算符表，像这样</p>

<pre><code>
Io&gt; OperatorTable
==&gt; OperatorTable_0x7fc123c76200:
Operators
  0   ? @ @@
  1   **
  2   % * /
  3   + -
  4   &lt;&lt; &gt;&gt;
  5   &lt; &lt;= &gt; &gt;=
  6   != ==
  7   &amp;
  8   ^
  9   |
  10  &amp;&amp; and
  11  or ||
  12  ..
  13  %= &amp;= *= += -= /= &lt;&lt;= &gt;&gt;= ^= |=
  14  return

Assign Operators
  ::= newSlot
  :=  setSlot
  =   updateSlot

To add a new operator: OperatorTable addOperator("+", 4) and implement the + message.
To add a new assign operator: OperatorTable addAssignOperator("=", "updateSlot") and implement the updateSlot message.
</code></pre>

<p>下面我们自定义一个异或运算符xor，如果只有一个参数为真，
则xor返回true，否则返回false。</p>

<pre><code>
Io&gt; OperatorTable addOperator("xor", 11)
==&gt; OperatorTable_0x7fc123c76200:
Operators
  0   ? @ @@
  1   **
  2   % * /
  3   + -
  4   &lt;&lt; &gt;&gt;
  5   &lt; &lt;= &gt; &gt;=
  6   != ==
  7   &amp;
  8   ^
  9   |
  10  &amp;&amp; and
  11  or xor ||
  12  ..
  13  %= &amp;= *= += -= /= &lt;&lt;= &gt;&gt;= ^= |=
  14  return

Assign Operators
  ::= newSlot
  :=  setSlot
  =   updateSlot

To add a new operator: OperatorTable addOperator("+", 4) and implement the + message.
To add a new assign operator: OperatorTable addAssignOperator("=", "updateSlot") and implement the updateSlot message.
</code></pre>

<p>在11那个位置上可以看到新的运算符，接下来对true和false
两种情况实现xor方法:</p>

<pre><code>
Io&gt; true xor := method(bool, if(bool, false, true))
==&gt; method(bool, 
    if(bool, false, true)
)
Io&gt; false xor := method(bool, if(bool, true, false))
==&gt; method(bool, 
    if(bool, true, false)
)
</code></pre>

<p>这就完成了实现</p>

<pre><code>
Io&gt; true xor true
==&gt; false
Io&gt; true xor false
==&gt; true
Io&gt; false xor true
==&gt; true
Io&gt; false xor false
==&gt; false
</code></pre>

<h3>消息</h3>

<p>在Io里，几乎一切都是消息，你可以查询任何消息的任何特性，
在对它们执行适当的操作。</p>

<p>一个消息由三部分组成，发送者(sender)， 目标(target)，
和参数(arguments)。在Io中，消息由发送者发送至目标，
然后由目标执行该消息。</p>

<p>你可以用call方法访问任何消息的元信息(meta information)。
下面创建2个对象，一个是获得消息的邮局对象postOffice，一个
是发送消息的寄信人mailer。</p>

<pre><code>
Io&gt; postOffice := Object clone
==&gt;  Object_0x7fc123eaeeb0:

Io&gt; postOffice packageSender := method(call sender)
==&gt; method(
    call sender
)
</code></pre>

<p>下面创建发送消息的寄信人</p>

<pre><code>
Io&gt; mailer := Object clone
==&gt;  Object_0x7fc124876b60:

Io&gt; mailer deliver := method(postOffice packageSender)
==&gt; method(
    postOffice packageSender
)
</code></pre>

<p>它有一个槽-deliver，该槽发送一个packageSender消息给postOffice。
现在我们有了一个可以发送消息的mailer对象。</p>

<pre><code>
Io&gt; mailer deliver
==&gt;  Object_0x7fc124876b60:
  deliver          = method(...)
</code></pre>

<p>deliver方法是发送消息的对象，我们还可以获取目标，像下面这样</p>

<pre><code>
Io&gt; postOffice messageTarget := method(call target)
==&gt; method(
    call target
)
Io&gt; postOffice messageTarget
==&gt;  Object_0x7fc123eaeeb0:
  messageTarget    = method(...)
  packageSender    = method(...)
</code></pre>

<p>这里的目标是邮局postOffice，我们还可以获取原消息名和参数。</p>

<pre><code>
Io&gt; postOffice messageArgs := method(call message arguments)
==&gt; method(
    call message arguments
)
Io&gt; postOffice messageName := method(call message name)
==&gt; method(
    call message name
)
Io&gt; postOffice messageArgs("one", 2, :three)
==&gt; list("one", 2, : three)
Io&gt; postOffice messageName
==&gt; messageName
</code></pre>

<h3>自定义控制结构</h3>

<p>实现unless</p>

<pre><code>
unless := method(
  (call sender doMessage(call message argAt(0))) ifFalse(
  call sender doMessage(call message argAt(1))) ifTrue(
  call sender doMessage(call message argAt(2)))
)

Io&gt; unless(1 == 2, write("one"), write("two"))
one==&gt; false
</code></pre>

<p>unless先执行第1个参数，如果是false，那么执行第2个参数，否则
执行第3个参数。<br/>
这里doMessage可以执行任意消息，Io会对消息参数进行解释，
但是是延迟绑定和执行的。</p>

</div>


            <div class="footer">
              <div class="contact">
                <div>lyuehh</div>
                <div>programmer</div>
                <div>lyuehh^gmail.com</div>
              </div>
              <div class="contact">
                <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                <a href="http://weibo.com/lyused/">weibo.com/lyused</a><br />
              </div>
            </div>
          </div>

        </div> <!-- /container -->

<!-- Duoshuo Comment BEGIN -->
  <div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"lyuehh-blog"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- Duoshuo Comment END -->
    </body>
</html>
