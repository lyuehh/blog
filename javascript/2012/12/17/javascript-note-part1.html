<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>JavaScript学习笔记 - part1</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/blog/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/blog/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/blog/index.html">blog</a></h1>
              <a class="extra" href="/blog/about.html">about</a>
            </div>

            <h2>JavaScript学习笔记 - part1</h2>
<p class="meta">2012-12-17 15:38</p>

<div id="post">
<ol>
<li>不要重复自己，代码只写一次，不复制粘贴</li>
<li>缓存数据</li>
<li>使用高阶函数</li>
<li>使用链式操作</li>
<li>使用闭包，隔离变量</li>
<li>使用'use strict'</li>
<li>使用封装</li>
<li>捕获错误</li>
</ol>


<hr />

<h2>不要重复</h2>

<p><code>javascript
/*
  demo1: do not repeat yourself
*/
$.ajax({
  'url': '/user',
  'data': 'dept=aaa&amp;active=true&amp;_=' + Math.random(),
  'dataType': 'json',
  'headers': {
    'X-CSRF-Token': $('#csrf').attr('content');
  },
  'type': 'GET',
  'success': function(ret) {
    if(ret.result === 0) {
      console.log('data: ' + JSON.stringify(ret.data));
    } else {
      console.log('request error: ' + ret.msg);
    }
  },
  'error': functoin(jqXHR, textStatus, errorThrown) {
    console.log('ajax error...')
  }
});
/*
  1. 使用全局ajaxError
*/
$(document).ajaxError(function() {
  console.log('ajax error...')
});
/*
  2. 使用全局ajaxSetup
*/
$.ajaxSetup({
  'dataType': 'json',
  'headers': {
    'X-CSRF-Token': $('#csrf').attr('content');
  },
  'cache': false
});
/*
  3. 使用快捷方法
*/
$.get('/user', function(ret) {
  // ....
});
/*
  4. 统一的错误处理
*/
var showErrorTips = function(ret) {
  console.log('request error: ' + ret.msg)
};
var Ajax = {
    get: function(url, callback) {
      $.get(url, function(ret) {
        if(ret.result === 0) {
          if(ret.data) {
            callback(ret.data);
          } else {
            callback(ret);
          }
        } else {
          showErrorTips(ret);
        }
      });
    },
    post: function(url, data, callback) {
      $.post(url, data, function (ret) {
        if(ret.result === 0) {
          if(ret.data) {
            callback(ret.data);
          } else {
            callback(ret);
          }
        } else {
          showErrorTips(ret);
        }
      });
    }
  };
/*
  result
*/
Ajax.get('/user' + '?dept=aaa&amp;active=true', function(data) {
  console.log('data: ' + JSON.stringify(data));
})
</code></p>

<h2>缓存数据</h2>

<p><code>javascript
/* tiny_store.js */
function Store() {
  this._data = {};
}
Store.prototype.set = function(key, value) {
  this._data[key] = value;
};
Store.prototype.get = function(key) {
  return this._data[key];
};
Store.prototype.clear = function() {
  this._data = {};
};
</code></p>

<p><code>javascript
var store = new Store();
Ajax.get('/user', function(data) {
  store.set('user', data);
});
console.log(store.get('user')); // use user anywhere else..
</code></p>

<h2>使用高阶函数</h2>

<p><code>javascript
/*
* for loop
*/
var sum = function(arr) {
  var sum = 0;
  for(var i=0,l=arr.length; i&lt;l; i++) {
    sum += i;
  }
  return sum;
};
/*
* high level function
*/
var sum2 = function(arr) {
  return arr.reduce(function(s, i) {
    return s + i;
  }, 0);
};
</code></p>

<h2>使用链式操作</h2>

<p><code>javascript
// use underscore.js, from http://underscorejs.org/#chain
var stooges = [{name : 'curly', age : 25}, {name : 'moe', age : 21}, {name : 'larry', age : 23}];
var youngest = _.chain(stooges)
  .sortBy(function(stooge){ return stooge.age; })
  .map(function(stooge){ return stooge.name + ' is ' + stooge.age; })
  .first()
  .value();
console.log(youngest);
</code></p>

<h2>使用闭包</h2>

<p><code>javascript
(function(){
  // code here...
}();
</code></p>

<h2>使用'use strict'</h2>

<p><code>javascript
(function(){
  'use strict';
  // code here...
}();
</code></p>

<h2>使用封装</h2>

<p><code>javascript
var store = (function() {
  var data;
  var getData = function () {
    return data;
  };
  var setData = function (d) {
    data = d;
  };
  var clearData = function () {
    data = null;
  };
  return {
    getData: getData,
    setData: setData,
    clearData: clearData
  };
})();
</code></p>

<h2>捕获错误</h2>

<p>大部分的js方法不会抛异常，比如除以0，访问不存在的属性等，但是也有一些会抛出异常，当抛出异常时，js就不会继续执行，大部分情况下会影响用户继续操作，一下列出部分可能会抛出异常的js方法。<br/>
所以调用这些方法时，一定要小心，可以先校验参数，看是否是需要的类型，也可以加上try catch。</p>

<h3>数组操作</h3>

<p>```javascript
new Array(-1); // invalid array length</p>

<p>[1,2,3,4].reduce(function(x,y) {
 return x*y;
}); // reduce of empty array with no initial value
```</p>

<h3>URL操作</h3>

<p>```javascript
decodeURIComponent('%XX'); //malformed URI sequence</p>

<p>// 以下操作也会抛出异常
encodeURI(uri);
decodeURI();
encodeURIComponent();
```</p>

<h3>JSON, evel, function</h3>

<p>```javascript</p>

<p>JSON.parse('xx'); // SyntaxError: JSON.parse
eval('asdf'); // ReferenceError: asdf is not defined</p>

<p>new Function('var'); // SyntaxError: missing variable name</p>

<p>_.include.apply([1,2,3],1);
// TypeError: second argument to Function.prototype.apply must be an array
```</p>

<h3>数字操作</h3>

<p>```javascript
var a = 34234234234.2342343;
a.toExponential(333); // RangeError: precision 333 out of range</p>

<p>// 这些操作也会
toFixed()
toPrecision()
```</p>

<h3>对象操作</h3>

<p>```javascript
Object.create('a');
//TypeError: Object prototype may only be an Object or null</p>

<p>// 这些操作也会
Object.defineProperties('a')
Object.defineProperty()
Object.freeze('a')
Object.isExtensible('a')
```</p>

</div>


            <div class="footer">
              <div class="contact">
                <div>lyuehh</div>
                <div>programmer</div>
                <div>lyuehh^gmail.com</div>
              </div>
              <div class="contact">
                <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                <a href="http://weibo.com/lyused/">weibo.com/lyused</a><br />
              </div>
            </div>
          </div>

        </div> <!-- /container -->

    </body>
</html>
